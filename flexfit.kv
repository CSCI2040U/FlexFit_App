#:import MDNavigationLayout kivymd.uix.navigationdrawer.MDNavigationLayout
#:import MDNavigationDrawer kivymd.uix.navigationdrawer.MDNavigationDrawer
#:import MDNavigationDrawerMenu kivymd.uix.navigationdrawer.MDNavigationDrawerMenu
#:import MDNavigationDrawerHeader kivymd.uix.navigationdrawer.MDNavigationDrawerHeader
#:import MDNavigationDrawerItem kivymd.uix.navigationdrawer.MDNavigationDrawerItem
#:import MDLabel kivymd.uix.label.MDLabel
#:import MDTopAppBar kivymd.uix.toolbar.MDTopAppBar

ScreenManager:
    SplashScreen:
    LoginScreen:
    SignUpScreen:
    UserInfoScreen:
    HomeScreen:
    SavedScreen:
    UserScreen:

<SplashScreen>:
    name: "splash"
    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: 1, 1, 1, 1
        spacing: "20dp"
        padding: "50dp"

        Image:
            source: "assets/logo.png"
            size_hint: None, None
            size: "150dp", "150dp"
            pos_hint: {"center_x": 0.5}

        MDLabel:
            text: "FlexFit"
            font_style: "H5"
            theme_text_color: "Custom"
            text_color: 0.6, 0.4, 1, 1
            halign: "center"

        MDRaisedButton:
            text: "Get Started"
            md_bg_color: 0.6, 0.4, 1, 1
            pos_hint: {"center_x": 0.5}
            on_release: app.switch_to_login()

<LoginScreen>:
    name: "login"
    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: 1, 1, 1, 1
        spacing: "20dp"
        padding: "50dp"

        MDLabel:
            text: "Login"
            font_style: "H4"
            halign: "center"
            theme_text_color: "Primary"

        MDTextField:
            id: login_email
            hint_text: "Email"
            icon_right: "email"
            mode: "rectangle"
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}

        PasswordTextField:
            id: login_password
            hint_text: "Password"
            password: True
            mode: "rectangle"
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}
            icon_right: "eye-off"

            MDCard:
                size_hint: None, None
                size: "35dp", "35dp"
                radius: [17,]  # Rounded like a circle
                md_bg_color: 0.9, 0.9, 0.9, 1  # Light gray background
                pos_hint: {"center_x": 0.97, "center_y": 0.5}

                MDIconButton:
                    id: password_toggle
                    icon: "eye-off"
                    size_hint: None, None
                    size: "30dp", "30dp"
                    on_release: root.toggle_password_visibility()

        MDRaisedButton:
            text: "Login"
            md_bg_color: 0.6, 0.4, 1, 1
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}
            on_release: app.switch_to_home()

        MDTextButton:
            text: "Forgot Password?"
            pos_hint: {"center_x": 0.5}
            theme_text_color: "Primary"

        MDCard:
            size_hint: None, None
            size: "45dp", "45dp"  # Square shape
            elevation: 0.75  # Adds shadow for depth
            radius: [50,]  # Rounded edges like in your image
            md_bg_color: 1, 1, 1, 1  # White background
            pos_hint: {"center_x": 0.5, "center_y": 0.5}

            MDIconButton:
                icon: "assets/google_logo.png"
                size_hint: None, None
                size: "40dp", "40dp"
                theme_icon_color: "Custom"
                icon_color: 1, 1, 1, 1  # Keeps original Google logo colors
                pos_hint: {"center_x": 0.5, "center_y": 0.5}
                on_release: app.google_sign_in()

        MDLabel:
            text: "Don't have an account? [ref=signup][b]Sign Up[/b][/ref]"
            markup: True
            theme_text_color: "Custom"
            text_color: 0.2, 0.4, 1, 1  # Blue hyperlink color
            halign: "center"
            on_ref_press: app.switch_to_signup()



<SignUpScreen>:
    name: "signup"
    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: 1, 1, 1, 1
        spacing: "20dp"
        padding: "50dp"

        MDLabel:
            text: "Sign Up"
            font_style: "H4"
            halign: "center"
            theme_text_color: "Primary"

        MDTextField:
            id: signup_name
            hint_text: "Full Name"
            icon_right: "account"
            mode: "rectangle"
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}

        MDTextField:
            id: signup_email
            hint_text: "Email"
            icon_right: "email"
            mode: "rectangle"
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}

        PasswordTextField:
            id: signup_password
            hint_text: "Password"
            password: True
            icon_right: "eye-off"
            mode: "rectangle"
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}

        PasswordTextField:
            id: signup_confirm_password
            hint_text: "Confirm Password"
            password: True
            icon_right: "eye-off"
            mode: "rectangle"
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}

        MDRaisedButton:
            text: "Sign Up"
            md_bg_color: 0.6, 0.4, 1, 1
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}
            on_release: app.switch_to_user_info()

        MDLabel:
            text: "Already have an account? [ref=login][b]Log In[/b][/ref]"
            markup: True
            theme_text_color: "Custom"
            text_color: 0.2, 0.4, 1, 1  # Blue hyperlink color
            halign: "center"
            on_ref_press: app.switch_to_login()


<UserInfoScreen>:
    name: "user_info"
    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: 1, 1, 1, 1
        padding: "30dp"
        spacing: "20dp"

        MDLabel:
            text: "Hey there,"
            font_style: "H6"
            halign: "center"
            theme_text_color: "Primary"

        MDLabel:
            text: "[b]Tell Us More About You[/b]"
            markup: True
            font_style: "H5"
            halign: "center"
            theme_text_color: "Primary"

        # Birthdate Input
        MDCard:
            size_hint_x: 0.9
            pos_hint: {"center_x": 0.5}
            padding: "15dp"
            radius: [15,]


            MDBoxLayout:
                orientation: "horizontal"
                spacing: "10dp"

                MDTextField:
                    id: birthdate
                    hint_text: "mm/dd/yyyy"
                    mode: "rectangle"
                    size_hint_x: 0.8
                    pos_hint: {"center_x": 0.5}
                    readonly: True  # Prevents keyboard from opening

                MDIconButton:
                    icon: "calendar"
                    pos_hint: {"center_x": 0.5}
                    on_release: app.open_date_picker()

        # Gender Selection Label
        MDBoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.9
            pos_hint: {"center_x": 0.5}
            spacing: "30dp"

            MDCard:
                id: male_card
                size_hint: None, None
                size: "80dp", "80dp"
                radius: [15,]
                md_bg_color: app.get_gender_color("male")
                on_release: app.select_gender("male")

                MDBoxLayout:
                    orientation: "vertical"
                    padding: "10dp"
                    spacing: "5dp"
                    pos_hint: {"center_x": 0.5, "center_y": 0.5}

                    MDIconButton:
                        icon: "human-male"
                        pos_hint: {"center_x": 0.5}

                    MDLabel:
                        text: "Male"
                        halign: "center"
                        theme_text_color: "Secondary"

            MDCard:
                id: female_card
                size_hint: None, None
                size: "80dp", "80dp"
                radius: [15,]
                md_bg_color: app.get_gender_color("female")
                on_release: app.select_gender("female")

                MDBoxLayout:
                    orientation: "vertical"
                    padding: "10dp"
                    spacing: "5dp"
                    pos_hint: {"center_x": 0.5, "center_y": 0.5}

                    MDIconButton:
                        icon: "human-female"
                        pos_hint: {"center_x": 0.5}

                    MDLabel:
                        text: "Female"
                        halign: "center"
                        theme_text_color: "Secondary"


        # Height & Weight Input Fields
        MDTextField:
            id: height
            hint_text: "Enter Your Height (e.g. 5'10\")"
            mode: "rectangle"
            size_hint_x: 0.9
            pos_hint: {"center_x": 0.5}

        MDTextField:
            id: weight
            hint_text: "Enter Your Weight (in kgs)"
            mode: "rectangle"
            size_hint_x: 0.9
            pos_hint: {"center_x": 0.5}

        # Continue Button
        MDRaisedButton:
            text: "Continue"
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}
            md_bg_color: 0.6, 0.4, 1, 1
            on_release: app.complete_user_info()

<HomeScreen>:
    name: "home"

    MDScreen:

        MDBoxLayout:
            orientation: 'vertical'
            size_hint_y: 1
            MDTextField:
                id: search_field
                hint_text: "Search"
                mode: "rectangle"
                icon_right: "magnify"
                size_hint_x: 0.9
                size_hint_y: 1/5
                pos_hint: {"center_x": 0.5}
                height: "40dp"
                md_bg_color: 0.95, 0.92, 1, 1
                radius: [25,]

            MDBoxLayout:
                orientation: "vertical"
                adaptive_height: True
                padding: dp(10)
                size_hint_y: 1

                MDLabel:
                    text: "Workouts"
                    font_style: "H6"
                    size_hint_y: None
                    height: self.texture_size[1]

                MDBoxLayout:
                    orientation: 'vertical'
                    size_hint_y: 1

                    MDCard:
                        radius: dp(10)
                        md_bg_color: 0.9, 0.9, 1, 1
                        BoxLayout:
                            orientation: 'vertical'
                            Image:
                                source: 'logo.png'  # Replace with actual image path
                                size_hint_y: 1/3
                            MDLabel:
                                text: "With Equipment"
                                halign: "center"

                    MDCard:
                        radius: dp(10)
                        md_bg_color: 0.9, 0.9, 1, 1
                        BoxLayout:
                            orientation: 'vertical'
                            Image:
                                source: 'assets/wellness_workout.jpg'  # Replace with actual image path
                                size_hint_y: 1/3
                            MDLabel:
                                text: "Wellness"
                                halign: "center"

                    MDCard:
                        radius: dp(10)
                        md_bg_color: 0.9, 0.9, 1, 1
                        BoxLayout:
                            orientation: 'vertical'
                            Image:
                                source: 'assets/wellness_workout.jpg'  # Replace with actual image path
                                size_hint_y: 1/3
                            MDLabel:
                                text: "Without Equipment"
                                halign: "center"

            MDBottomNavigation:
                id: bottom_nav
                height: "60dp"
                panel_color: "#eeeeee"
                pos_hint: {"bottom": 1}

                MDBottomNavigationItem:
                    name: "home"
                    text: "Home"
                    icon: "home"
                    on_tab_press: app.switch_to_screen("home", nav_home)

                MDBottomNavigationItem:
                    name: "saved"
                    text: "Saved"
                    icon: "bookmark"
                    on_tab_press: app.switch_to_screen("saved", nav_saved)

                MDBottomNavigationItem:
                    name: "user"
                    text: "User"
                    icon: "account"
                    on_tab_press: app.switch_to_screen("user", nav_user)



<SavedScreen>
    name: 'saved'

<UserScreen>
    name: 'user'
    MDBoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        spacing: dp(10)

        # Profile Section
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(100)

            Image:
                source: "logo.png"
                size_hint: None, None
                size: dp(80), dp(80)
                allow_stretch: True
                keep_ratio: True
                pos_hint: {'center_y': 0.5}

            MDBoxLayout:
                orientation: 'vertical'
                spacing: dp(5)
                pos_hint: {'center_y': 0.5}

                MDLabel:
                    text: "Hello User!"
                    bold: True
                    font_style: "H5"

                MDBoxLayout:
                    orientation: 'horizontal'

                    MDCard:
                        size_hint_x: None
                        width: dp(150)
                        elevation: 2
                        radius: [10]
                        padding: dp(5)

                        MDBoxLayout:
                            orientation: 'vertical'
                            spacing: dp(5)
                            MDLabel:
                                text: "Height - 5'10\""
                            MDRaisedButton:
                                text: "Edit"
                                size_hint_x: None
                                width: dp(60)
                                font_size: "12sp"

                    MDCard:
                        size_hint_x: None
                        width: dp(150)
                        elevation: 2
                        radius: [10]
                        padding: dp(5)

                        MDBoxLayout:
                            orientation: 'vertical'
                            spacing: dp(5)
                            MDLabel:
                                text: "Weight - 80kg"
                            MDRaisedButton:
                                text: "Edit"
                                size_hint_x: None
                                width: dp(60)
                                font_size: "12sp"

        # Progress Indicators Section
        MDBoxLayout:
            orientation: 'vertical'
            padding: dp(10)
            spacing: dp(10)

            Widget:
                size_hint_y: None
                height: dp(140)
                canvas.before:
                    Color:
                        rgba: 0.5, 0.2, 0.8, 1
                    Line:
                        width: 3
                        circle: (self.center_x, self.center_y, 60, 0, 180)

            MDLabel:
                text: "1600/2000"
                halign: "center"
                font_style: "H6"

            MDRaisedButton:
                text: "Calories Goal"
                size_hint_x: None
                width: dp(140)
                pos_hint: {"center_x": 0.5}

            MDProgressBar:
                value: 80
                pos_hint: {"center_x": 0.5}
                size_hint_x: 0.9

            MDLabel:
                text: "240/300 mins."
                halign: "center"
                font_style: "H6"

            MDRaisedButton:
                text: "Weekly Time Spent"
                size_hint_x: None
                width: dp(180)
                pos_hint: {"center_x": 0.5}

        MDLabel:
            text: "Making good progress!"
            halign: "center"
            font_style: "H5"

        # Bottom Navigation
        MDBottomNavigation:
            height: dp(60)
            panel_color: "#eeeeee"
            pos_hint: {"bottom": 1}

            MDBottomNavigationItem:
                name: "home"
                text: "Home"
                icon: "home"

            MDBottomNavigationItem:
                name: "saved"
                text: "Saved"
                icon: "bookmark"

            MDBottomNavigationItem:
                name: "user"
                text: "User"
                icon: "account"
